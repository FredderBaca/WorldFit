<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Worldfit - Productos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @keyframes scaleIn {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-scaleIn { animation: scaleIn 0.4s ease forwards; }
    .animate-fadeIn { animation: fadeIn 0.3s ease forwards; }
  </style>
</head>
<body class="bg-black text-gray-100">

  <div class="flex h-screen">

    <aside id="sidebar" class="fixed md:static top-0 left-0 h-full w-64 bg-gray-900 text-white flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
      <div class="px-6 py-4 flex justify-between items-center ">
        <img id="closeSidebar" src="src/imagenes/Logo.png">
      </div>
      <div class="flex flex-col items-center py-6 border-b border-gray-700">
        <img src="src/imagenes/perfil.png" alt="perfil" class="w-20 h-20 rounded-full border-2 border-red-500">
        <h2 class="mt-2 font-semibold">Admin GYM</h2>
        <span class="text-sm text-gray-400">Administrador</span>
      </div>
      <div class="px-4 py-2">
        <input type="text" placeholder="Buscar.." class="w-full px-3 py-2 rounded bg-gray-800 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500">
      </div>
      <nav class="flex-1 px-2 py-4 space-y-2">
        <a href="inicio.html" class="flex items-center px-4 py-2 rounded hover:bg-gray-800 transition">
          <i data-feather="home" class="w-5 h-5 mr-3"></i> Inicio
        </a>
        <a href="productos.html" class="bg-red-600 flex items-center px-4 py-2 rounded hover:bg-gray-800 transition">
          <i data-feather="shopping-cart" class="w-5 h-5 mr-3"></i> Productos
        </a>
        <a href="registro.html" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded">
          <i data-feather="user-plus" class="w-5 h-5 mr-3"></i> Registro
        </a>
        <a href="administracion.html" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded">
          <i data-feather="settings" class="w-5 h-5 mr-3"></i> Administración
        </a>
        <a href="cuentas.html" class="flex items-center px-4 py-2 hover:bg-gray-800 rounded">
          <i data-feather="user" class="w-5 h-5 mr-3"></i> Cuenta
        </a>
      </nav>
    </aside>

    <div class="flex-1 flex flex-col bg-gray-100">

      <header class="bg-white shadow px-6 py-4 flex justify-between items-center">
        <button id="openSidebar" class="md:hidden">
          <i data-feather="menu" class="w-6 h-6 text-black"></i>
        </button>
        <div class="flex items-center space-x-3 ml-auto">
          <div><img class="w-8 h-8 rounded-full" src="src/imagenes/perfil.png"></div>
          <span class="text-black">Admin</span>
          <span class="w-2 h-2 bg-red-500 rounded-full"></span>
        </div>
      </header>

      <main class="flex-1 p-6 space-y-6 overflow-y-auto">
        <section>
          <h2 class="text-2xl font-semibold text-red-600 mb-2">Bienvenido al Panel de Productos</h2>
          <p class="text-gray-700">Gestiona suplementos, accesorios y artículos disponibles en tu gimnasio.</p>
        </section>
        <section>
          <button class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">
            Añadir Producto
          </button>
          <button class="ml-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">
            Renovar Stock
          </button>
        </section>

        <section class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
          </section>

      </main>
    </div>
  </div>

  <div id="modal" class="fixed inset-0 bg-black bg-opacity-80 hidden flex items-center justify-center z-40">
    <div class="bg-gray-900 p-6 rounded-xl shadow-lg w-80 text-center border-2 border-red-600">
      <img id="modal-img" src="" alt="Producto" class="h-40 mx-auto mb-4 rounded object-contain">
      <h2 id="modal-title" class="text-xl font-bold text-red-500"></h2>
      <p class="text-gray-300 mb-2">Ingrese cantidad:</p>
      <input id="cantidad" type="number" min="1" value="1" class="w-full px-3 py-2 mb-3 rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-red-500">
      <p id="total" class="text-lg font-semibold text-white mb-4">Total: C$0</p>
      <div class="flex justify-around">
        <button id="guardar" class="px-4 py-2 bg-green-600 rounded hover:bg-green-700 transition">Guardar</button>
        <button id="cancelar" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700 transition">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="modalAñadir" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white text-gray-900 rounded-xl p-6 w-[400px] shadow-lg relative">
      <h2 class="text-xl font-bold text-red-600 mb-4 text-center">Añadir Producto</h2>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold mb-1">Imagen del Producto</label>
          <input type="file" id="imagenProducto" accept="image/*" class="w-full border rounded p-2">
          <img id="previewImg" class="mt-3 w-full h-40 object-contain rounded border hidden" alt="Vista previa">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Nombre</label>
          <input type="text" id="nombreProducto" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Precio</label>
          <input type="number" id="precioProducto" class="w-full border rounded p-2">
        </div>
        <div>
            <label class="block text-sm font-semibold mb-1">Stock Inicial</label>
            <input type="number" id="stockProducto" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Descripción</label>
          <textarea id="descripcionProducto" rows="2" class="w-full border rounded p-2"></textarea>
        </div>
      </div>
      <div class="flex justify-between mt-5">
        <button id="btnAceptarProducto" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Aceptar</button>
        <button id="btnEliminarProducto" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Eliminar</button>
        <button id="btnCerrarAñadir" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Cerrar</button>
      </div>
    </div>
  </div>

  <div id="modalStock" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white text-gray-900 rounded-xl p-6 w-[380px] shadow-lg relative">
      <h2 class="text-xl font-bold text-red-600 mb-4 text-center">Renovar Stock</h2>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-semibold mb-1">Nombre o ID del Producto</label>
          <input type="text" id="nombreStock" class="w-full border rounded p-2" placeholder="Ej. Proteína Whey o #001">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Cantidad</label>
          <input type="number" id="cantidadStock" class="w-full border rounded p-2" min="1">
        </div>
      </div>
      <div class="flex justify-between mt-5">
        <button id="btnAceptarStock" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Aceptar</button>
        <button id="btnCerrarStock" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Cerrar</button>
      </div>
    </div>
  </div>

  <div id="successAnimation" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
      <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col items-center animate-fadeIn">
          <svg class="w-16 h-16 text-green-500 animate-scaleIn" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
          </svg>
          <p id="successMessage" class="mt-3 text-lg font-semibold text-green-600">Acción Exitosa</p>
      </div>
  </div>

  <script>
    feather.replace();

    // --- SIDEBAR ---
    const sidebar = document.getElementById("sidebar");
    const openBtn = document.getElementById("openSidebar");
    const closeBtn = document.getElementById("closeSidebar");
    openBtn?.addEventListener("click", () => sidebar.classList.remove("-translate-x-full"));
    closeBtn?.addEventListener("click", () => sidebar.classList.add("-translate-x-full"));

    // --- ELEMENTOS PRINCIPALES ---
    const gridProductos = document.querySelector("section.grid");
    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modal-img");
    const modalTitle = document.getElementById("modal-title");
    const cantidadInput = document.getElementById("cantidad");
    const total = document.getElementById("total");
    let precioActual = 0;

    // --- MODALES ---
    const modalAñadir = document.getElementById("modalAñadir");
    const modalStock = document.getElementById("modalStock");
    const btnAñadir = document.querySelector("button.bg-red-600");
    const btnStock = document.querySelectorAll("button.bg-red-600")[1];
    const btnCerrarAñadir = document.getElementById("btnCerrarAñadir");
    const btnCerrarStock = document.getElementById("btnCerrarStock");

    // --- ELEMENTOS ANIMACIÓN --- // MODIFICADO
    const successAnim = document.getElementById("successAnimation");
    const successMessage = document.getElementById("successMessage");

    // --- CAMPOS MODAL AÑADIR ---
    const imagenProducto = document.getElementById("imagenProducto");
    const previewImg = document.getElementById("previewImg");
    const nombreProducto = document.getElementById("nombreProducto");
    const precioProducto = document.getElementById("precioProducto");
    const stockProducto = document.getElementById("stockProducto");
    const descripcionProducto = document.getElementById("descripcionProducto");
    const btnAceptarProducto = document.getElementById("btnAceptarProducto");
    const btnEliminarProducto = document.getElementById("btnEliminarProducto");

    // --- ABRIR Y CERRAR MODALES ---
    btnAñadir.addEventListener("click", () => modalAñadir.classList.remove("hidden"));
    btnStock.addEventListener("click", () => modalStock.classList.remove("hidden"));
    btnCerrarAñadir.addEventListener("click", () => modalAñadir.classList.add("hidden"));
    btnCerrarStock.addEventListener("click", () => modalStock.classList.add("hidden"));

    // --- LISTA DE PRODUCTOS --- // MODIFICADO para incluir id y stock
    let productos = JSON.parse(localStorage.getItem("productos")) || [
      {
        id: "#001",
        nombre: "Proteína Whey",
        descripcion: "Suplemento alimenticio",
        precio: 2400,
        stock: 15,
        imagen: "src/imagenes/prote.webp"
      },
      {
        id: "#002",
        nombre: "Creatina",
        descripcion: "Mejora el rendimiento",
        precio: 1200,
        stock: 25,
        imagen: "src/imagenes/creatina.webp"
      },
      {
        id: "#003",
        nombre: "Pre-entreno",
        descripcion: "Energía para entrenar",
        precio: 800,
        stock: 10,
        imagen: "src/imagenes/venom.webp"
      },
      {
        id: "#004",
        nombre: "Camisa GYMSHARK",
        descripcion: "Entrena con estilo",
        precio: 700,
        stock: 30,
        imagen: "src/imagenes/camisa.webp"
      }
    ];

    // --- FUNCIÓN PARA RENDERIZAR PRODUCTOS --- // MODIFICADO para mostrar id y stock
    function renderProductos() {
      gridProductos.innerHTML = "";
      productos.forEach((p) => {
        const card = document.createElement("div");
        card.className = "bg-gray-700 p-4 rounded-xl shadow cursor-pointer producto hover:ring-2 hover:ring-red-500 transition";
        card.innerHTML = `
          <div class="flex justify-center items-center h-48">
            <img src="${p.imagen}" alt="${p.nombre}" class="object-contain h-full w-full rounded">
          </div>
          <h3 class="text-lg font-bold mt-2">${p.nombre}</h3>
          <p class="text-gray-400 text-sm">${p.descripcion}</p>
          <div class="flex justify-between items-center text-xs mt-2 text-gray-400">
            <span>ID: ${p.id}</span>
            <span class="font-semibold ${p.stock < 5 ? 'text-red-500' : 'text-green-500'}">Stock: ${p.stock}</span>
          </div>
          <span class="mt-1 font-semibold text-red-500 block">C$ <span class="font-bold text-white">${p.precio}</span></span>
        `;
        gridProductos.appendChild(card);

        card.addEventListener("click", () => {
          modalTitle.textContent = p.nombre;
          modalImg.src = p.imagen;
          precioActual = parseFloat(p.precio);
          cantidadInput.value = 1;
          cantidadInput.max = p.stock; // No permitir vender más de lo que hay
          total.textContent = "Total: C$" + precioActual;
          modal.classList.remove("hidden");
        });
      });
    }

    renderProductos();

    // --- MODAL COMPRA ---
    cantidadInput.addEventListener("input", () => {
      const cantidad = parseInt(cantidadInput.value) || 0;
      total.textContent = "Total: C$" + (cantidad * precioActual);
    });

    document.getElementById("cancelar").addEventListener("click", () => {
      modal.classList.add("hidden");
    });
    
    // --- MODIFICADO: Lógica para el botón guardar con animación ---
    document.getElementById("guardar").addEventListener("click", () => {
        modal.classList.add("hidden"); // Ocultar el modal de venta
        
        // Configurar y mostrar la animación de éxito
        successMessage.textContent = "Venta Registrada";
        successAnim.classList.remove("hidden");

        // Ocultar la animación después de 2 segundos
        setTimeout(() => {
            successAnim.classList.add("hidden");
        }, 2000);
    });

    // --- VISTA PREVIA DE IMAGEN NUEVA ---
    imagenProducto.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          previewImg.src = reader.result;
          previewImg.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    // --- GUARDAR NUEVO PRODUCTO ---
    btnAceptarProducto.addEventListener("click", () => {
      const nombre = nombreProducto.value.trim();
      const precio = parseFloat(precioProducto.value);
      const stock = parseInt(stockProducto.value);
      const descripcion = descripcionProducto.value.trim();
      const imagen = previewImg.src;

      if (!nombre || !precio || !stock || !imagen) {
        alert("⚠️ Por favor completa todos los campos.");
        return;
      }
      
      const nuevoId = "#" + String(productos.length + 1).padStart(3, '0');
      const nuevoProducto = { id: nuevoId, nombre, precio, stock, descripcion, imagen };
      productos.push(nuevoProducto);
      localStorage.setItem("productos", JSON.stringify(productos));

      renderProductos();
      modalAñadir.classList.add("hidden");
      
      // Limpiar campos
      nombreProducto.value = "";
      precioProducto.value = "";
      stockProducto.value = "";
      descripcionProducto.value = "";
      imagenProducto.value = ""; // Limpiar el input file
      previewImg.classList.add("hidden");
      previewImg.src = "";
    });

    // --- RENOVAR STOCK (SIMULADO) ---
    const btnAceptarStock = document.getElementById("btnAceptarStock");
    btnAceptarStock.addEventListener("click", () => {
        const nombreOId = document.getElementById("nombreStock").value.trim();
        const cantidad = parseInt(document.getElementById("cantidadStock").value);

        if (!nombreOId || !cantidad) {
            alert("⚠️ Por favor completa todos los campos.");
            return;
        }

        const productoEncontrado = productos.find(p => p.nombre.toLowerCase() === nombreOId.toLowerCase() || p.id === nombreOId);

        if (productoEncontrado) {
            productoEncontrado.stock += cantidad;
            localStorage.setItem("productos", JSON.stringify(productos));
            renderProductos();
            modalStock.classList.add("hidden");
            // Usar la animación también aquí
            successMessage.textContent = "Stock Actualizado";
            successAnim.classList.remove("hidden");
            setTimeout(() => {
                successAnim.classList.add("hidden");
            }, 2000);
        } else {
            alert("❌ Producto no encontrado.");
        }
    });
  </script>

</body>
</html>